import React, { useState } from "react";
import { useDispatch, useSelector } from "react-redux";
import {
  clearData,
  selectHistoryData,
  setHistoryData,
} from "../slice/HistorySlice";
import "../search.css";
import { useNavigate } from "react-router-dom";

interface HistoryProps {}

const History: React.FC<HistoryProps> = ({}) => {
  const [isLoading, setIsLoading] = useState(false);

  const [ref, setRef] = useState(false);
  const navigate = useNavigate();
  const dispatch = useDispatch();
  const historys = useSelector(selectHistoryData);
  const handleDelete = (query: string) => {
    dispatch(clearData({ data: query }));
  };

  const handleSearch = (query: any) => {
    if (query.trim()) {
      dispatch(setHistoryData({ data: query.trim() }));
      navigate(`/search?query=${encodeURIComponent(query.trim())}`);
    }
  };

  return (
    <div
      className={`${
        historys.length > 0 && "border-b-[1px] border-[#ffffff1f]"
      }`}
    >
      <div className="flex flex-col mb-[10px]  gap-[8px] pb-[0px] max-h-[200px] overflow-y-auto">
        {historys?.map((hs: any, index: any) => (
          <button
            key={index}
            onClick={() => handleSearch(hs)}
            className="py-[10px] items-center flex justify-between text-white font-[400]"
          >
            <div className="flex items-center gap-2 flex-1 min-w-0">
              {" "}
              <span>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="14"
                  height="14"
                  viewBox="0 0 14 14"
                  fill="none"
                >
                  <path
                    d="M12.6121 4.81552C12.7583 5.18928 12.8661 5.57694 12.9337 5.97252C12.9534 6.08596 13.0124 6.18883 13.1004 6.26303C13.1884 6.33723 13.2998 6.378 13.4149 6.37816C13.4426 6.37801 13.4703 6.37561 13.4976 6.371C13.5608 6.3602 13.6213 6.33705 13.6756 6.30286C13.7299 6.26868 13.7769 6.22413 13.814 6.17177C13.851 6.11941 13.8774 6.06025 13.8916 5.99769C13.9058 5.93512 13.9075 5.87038 13.8967 5.80714C13.8171 5.34724 13.6919 4.8964 13.523 4.46132C13.4759 4.34044 13.3828 4.24321 13.264 4.19101C13.1453 4.13881 13.0107 4.13592 12.8898 4.18297C12.7689 4.23003 12.6717 4.32318 12.6195 4.44192C12.5673 4.56067 12.5644 4.69529 12.6114 4.81617L12.6121 4.81552Z"
                    fill="white"
                    fill-opacity="0.4"
                  />
                  <path
                    d="M10.3993 2.02734C10.48 2.08313 10.5759 2.11289 10.674 2.11264C10.7783 2.11257 10.8798 2.07912 10.9637 2.01719C11.0476 1.95526 11.1095 1.8681 11.1403 1.76847C11.1711 1.66884 11.1691 1.56197 11.1348 1.46351C11.1005 1.36505 11.0355 1.28016 10.9494 1.22128C10.5647 0.958782 10.1546 0.735428 9.72538 0.554555C9.66572 0.524203 9.60046 0.50644 9.53365 0.502369C9.46684 0.498298 9.39991 0.508005 9.33701 0.530888C9.2741 0.553771 9.21658 0.589342 9.168 0.63539C9.11942 0.681439 9.08083 0.736982 9.05462 0.798572C9.02841 0.860161 9.01514 0.926482 9.01564 0.993414C9.01614 1.06035 9.03039 1.12646 9.05751 1.18766C9.08463 1.24885 9.12404 1.30382 9.1733 1.34914C9.22255 1.39446 9.2806 1.42917 9.34384 1.45112C9.71365 1.60821 10.0672 1.80121 10.3993 2.02734Z"
                    fill="white"
                    fill-opacity="0.4"
                  />
                  <path
                    d="M12.0215 2.12334C11.977 2.07664 11.9237 2.03922 11.8646 2.01325C11.8056 1.98728 11.7419 1.97326 11.6774 1.97201C11.6129 1.97077 11.5488 1.98232 11.4888 2.00599C11.4288 2.02966 11.3741 2.06499 11.3278 2.10994C11.2815 2.15489 11.2446 2.20856 11.2192 2.26786C11.1938 2.32715 11.1804 2.3909 11.1797 2.45541C11.1791 2.51992 11.1912 2.58392 11.2155 2.64371C11.2397 2.70349 11.2755 2.75789 11.3209 2.80374C11.601 3.09193 11.8516 3.40732 12.069 3.74523C12.1037 3.79919 12.1487 3.84577 12.2015 3.88233C12.2542 3.9189 12.3136 3.94471 12.3763 3.95832C12.439 3.97192 12.5037 3.97304 12.5669 3.96162C12.63 3.95019 12.6903 3.92644 12.7442 3.89173C12.7982 3.85702 12.8448 3.81201 12.8813 3.7593C12.9179 3.70658 12.9437 3.64717 12.9573 3.58448C12.9709 3.52178 12.972 3.45702 12.9606 3.39389C12.9492 3.33075 12.9254 3.27049 12.8907 3.21654C12.6379 2.82424 12.3467 2.45805 12.0215 2.12334Z"
                    fill="white"
                    fill-opacity="0.4"
                  />
                  <path
                    d="M8.38968 0.139335C7.43096 -0.0548628 6.44219 -0.0459723 5.48713 0.165433C4.53207 0.376839 3.63191 0.786067 2.84472 1.36673C2.05752 1.94738 1.40077 2.68658 0.916799 3.53665C0.432832 4.38672 0.132399 5.32878 0.0348764 6.30209C-0.0626465 7.2754 0.0449055 8.25834 0.350596 9.18753C0.656287 10.1167 1.15333 10.9715 1.80967 11.6968C2.46601 12.4221 3.26708 13.0018 4.16121 13.3985C5.05535 13.7952 6.0227 14.0001 7.00088 13.9999C8.73837 14.0069 10.4158 13.3647 11.7046 12.1994C12.9933 11.034 13.8004 9.42934 13.9676 7.6999C13.9764 7.57324 13.9354 7.44814 13.8535 7.35116C13.7715 7.25417 13.655 7.19292 13.5287 7.18039C13.4023 7.16785 13.2761 7.20503 13.1767 7.28402C13.0773 7.36302 13.0125 7.47762 12.9962 7.60354C12.8795 8.76303 12.429 9.86377 11.6992 10.7723C10.9694 11.6808 9.99172 12.3581 8.88467 12.7221C7.77761 13.086 6.58874 13.1209 5.46222 12.8227C4.3357 12.5244 3.31991 11.9057 2.53801 11.0416C1.75611 10.1775 1.2417 9.10512 1.05713 7.95448C0.872566 6.80385 1.02578 5.62438 1.4982 4.55909C1.97062 3.4938 2.74195 2.58844 3.71867 1.9528C4.69538 1.31715 5.83554 0.978514 7.00088 0.977952C7.40274 0.978183 7.80359 1.01809 8.1976 1.0971C8.22939 1.10298 8.26164 1.10603 8.29396 1.10622C8.4149 1.10586 8.53139 1.06064 8.6209 0.979313C8.7104 0.897988 8.76655 0.786345 8.77846 0.666C8.79037 0.545655 8.75721 0.42517 8.68538 0.327876C8.61356 0.230581 8.50819 0.163398 8.38968 0.139335Z"
                    fill="white"
                    fill-opacity="0.4"
                  />
                  <path
                    d="M1.78906 7.00079C1.78906 8.03099 2.09455 9.03806 2.6669 9.89464C3.23925 10.7512 4.05276 11.4188 5.00454 11.8131C5.95632 12.2073 7.00364 12.3105 8.01405 12.1095C9.02445 11.9085 9.95257 11.4124 10.681 10.684C11.4095 9.9555 11.9056 9.02738 12.1066 8.01697C12.3076 7.00657 12.2044 5.95925 11.8102 5.00747C11.4159 4.05569 10.7483 3.24218 9.89171 2.66983C9.03513 2.09748 8.02806 1.79199 6.99786 1.79199C5.6164 1.79199 4.29152 2.34077 3.31468 3.31761C2.33784 4.29445 1.78906 5.61933 1.78906 7.00079ZM7.48618 3.74529V6.75337L9.89525 8.56343C9.94656 8.6019 9.98978 8.65011 10.0224 8.70529C10.0551 8.76047 10.0766 8.82155 10.0857 8.88503C10.0947 8.94851 10.0912 9.01316 10.0753 9.07528C10.0594 9.1374 10.0314 9.19578 9.99292 9.24708C9.95444 9.29839 9.90624 9.34161 9.85106 9.37428C9.79588 9.40695 9.7348 9.42844 9.67132 9.4375C9.60783 9.44657 9.54319 9.44305 9.48107 9.42713C9.41894 9.41122 9.36057 9.38322 9.30926 9.34475L6.70486 7.39145C6.6438 7.34636 6.59427 7.28746 6.56032 7.21956C6.52637 7.15166 6.50897 7.0767 6.50953 7.00079V3.74529C6.50953 3.61578 6.56098 3.49157 6.65256 3.39999C6.74414 3.30841 6.86835 3.25697 6.99786 3.25697C7.12737 3.25697 7.25158 3.30841 7.34316 3.39999C7.43474 3.49157 7.48618 3.61578 7.48618 3.74529Z"
                    fill="white"
                    fill-opacity="0.4"
                  />
                </svg>
              </span>{" "}
              <span className="truncate pr-1">{hs}</span>
            </div>
            <button
              onClick={(e) => {
                e.stopPropagation();
                handleDelete(hs);
              }}
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="12"
                height="12"
                viewBox="0 0 12 12"
                fill="none"
              >
                <path
                  d="M6 4.66688L10.0003 0.666562C10.3684 0.29843 10.9653 0.29843 11.3334 0.666562C11.7016 1.03469 11.7016 1.63155 11.3334 1.99969L7.33312 6L11.3334 10.0003C11.7016 10.3684 11.7016 10.9653 11.3334 11.3334C10.9653 11.7016 10.3684 11.7016 10.0003 11.3334L6 7.33312L1.99969 11.3334C1.63155 11.7016 1.03469 11.7016 0.666562 11.3334C0.29843 10.9653 0.29843 10.3684 0.666562 10.0003L4.66688 6L0.666562 1.99969C0.29843 1.63155 0.29843 1.03469 0.666562 0.666562C1.03469 0.29843 1.63155 0.29843 1.99969 0.666562L6 4.66688Z"
                  fill="white"
                  fill-opacity="0.4"
                />
              </svg>
            </button>
          </button>
        ))}
      </div>
    </div>
  );
};

export default History;
